# ZCU106 Platform

The ZCU106 is a ZynqUltrascale+ FPGA-SoC evaluation kit from AMD/Xilinx.

Reference site : https://www.xilinx.com/products/boards-and-kits/zcu106.html

## Requirements

- (Optional) To recreate and rebuild the hardware project [Vivado 2023.1](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vivado-design-tools/2023-1.html) with support for ZynqUltrascale+ devices is required.
- To build Linux and generate the boot images [Petalinux 2023.1](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools/2023-1.html) is required.

Other versions might work too but this was tested with the 2023.1 version.

## Hardware project

To avoid clutter in the git repository a single tcl script is given. This script allows to entirely recreate the hardware project. Note that unless you want to modifiy the hardware project it is optional to recreate the hardware project as the XSA (hardware description file) is provided.

### (Optional) Recreate the hardware project

From Vivado 2023.1 select "Tools" - "Run Tcl Script..." and choose the script in the `hardware` directory. This will recreate the full project. If you want to create the project at an other location just move the script.

This can also be done from the command line with :

```shell
vivado -mode tcl -source zcu106_pcie.tcl
```

Once the project recreated the bitstream can be generated by clicking "Generate Bitstream".

### (Optional) Export hardware (XSA file)

In order to build the bootable images for the project through petalinux the hardware description file (XSA file) must be exported. To do so click on "Files" - "Export" - "Export Hardware" and choose to include the bitstream.

### Building Petalinux and the Boot images

In order to make the scripts below clearer let's assume we work in the `work` directory.

To facilitate development we will build from an external Linux source (that we will be able to modify directly, rather than applying patches to the default Petalinux linux).

```shell
cd work
git clone https://github.com/rick-heig/linux-xlnx.git
cd linux-xlnx
git checkout csd_20231212
```

```shell
# Create the project
petalinux-create --type project --template zynqMP --name csd
# Copy files
# Configure the project with the XSA file
petalinux-config --get-hw-description=/path/to/exported_hardware.xsa
# Configure the project (select options)
# Build the project
petalinux-build
# Package the project
petalinux-package --boot --fsbl --fpga --pmufw --u-boot --force
```

